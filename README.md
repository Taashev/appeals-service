# Сервис обработки обращений

## Описание проекта

Данный проект реализует сервис для управления обращениями с поддержкой истории изменений статусов. Система построена с учетом масштабируемости и расширяемости, что позволяет легко добавлять новый функционал и интеграции.

## Основной стек технологий

- Node.js
- TypeScript
- Express.js
- TypeORM
- PostgreSQL
- Docker

## Подходы и принципы разработки

- Чистая архитектура и разделение ответственности между слоями
- Использование TypeORM и QueryBuilder для работы с базой данных
- Вся работа по изминению БД ведется через миграции
- Применяются транзакции для обеспечения целостности данных
- Валидация данных через DTO и отдельные middleware
- Централизованная обработка ошибок
- Следование принципам SOLID и DRY

## История обращений

В проекте реализована отдельная таблица для хранения истории изменений статусов обращений (`appeal-status-history`). Это позволяет отслеживать все изменения по каждому обращению и предоставляет возможности для дальнейшего расширения функционала, аналитики и поддержки.

## Требования для запуска

- Node.js (рекомендуется использовать nvm для управления версиями, в проекте есть файл `.nvmrc`)
- PostgreSQL
- Docker и docker-compose (опционально)

## Переменные окружения

В проекте присутствует шаблонный файл `.env.example`, который можно использовать для тестового запуска и проверки работоспособности. Для полноценной работы рекомендуется создать свой `.env` на основе этого шаблона.

## Клонирование и запуск проекта

### 1. Клонирование репозитория

```bash
git clone https://github.com/Taashev/appeals-service.git
cd appeal-service
```

### 2. Запуск локально (без Docker)

1. Установите зависимости:
   ```bash
   npm ci
   ```
2. Установите Node.js версии из `.nvmrc`:
   ```bash
   nvm use
   ```
3. Создайте файл `.env` на основе `.env.example` и заполните необходимые переменные или используйте переменные по умолчанию из файла `.env.example`.
4. Запустите миграции и приложение:
   ```bash
   npm run typeorm migration:run
   npm run start
   ```

### 3. Запуск с помощью Docker

1. Создайте файл `.env` на основе `.env.example` и заполните необходимые переменные или используйте переменные по умолчанию из файла `.env.example`.
2. Запустите сервисы с указанием файла `.env`:
   ```bash
   docker-compose --env-file .env.example up
   ```

---

## Эндпоинты API v1

- **GET /api/v1/appeals** — Получить список всех обращений с возможностью фильтрации по дате в query параметрах.
  - params:
    - date=2025-25-25 за конкрутную дату
    - date_from=2025-25-25 начала периода, date_to=2025-25-25 конец периода, не может быть меньше нечала и имеет приоритет над date|
- **POST /api/v1/appeals** — создаёт новое обращение.
  - body:
    - theme: string
    - message: string
- **POST /api/v1/appeals/:id/status/take** — переводит обращение в статус "В работе" по id.
  - params:
    - id: uuid
  - body:
    - comment: string
- **POST /api/v1/appeals/:id/status/complete** — завершает обращение по id, принимает комментарий.
  - params:
    - id: uuid
  - body:
    - comment: string
- **POST /api/v1/appeals/:id/status/cancel** — отменяет обращение по id, принимает комментарий.
  - params:
    - id: uuid
  - body:
    - comment: string
- **POST /api/v1/appeals/cancel-in-work** — отменяет все обращения, находящиеся в статусе "В работе", принимает комментарий.
  - body:
    - comment: string
